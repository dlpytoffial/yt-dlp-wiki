# Youtube

## PO Token Guide

Proof of Origin (PO) token is a parameter that YouTube requires to be sent with video playback requests from some clients. Without it, requests for the affected clients' format URLs may return HTTP Error 403, or result in your account or IP address being blocked.

This token is generated by BotGuard (web) / DroidGuard (android) to attest the requests are coming from a real client.

When logged out, the PO Token is bound to a Visitor ID, which appears to represent a session on YouTube. This Visitor ID is found in the `VISITOR_INFO1_LIVE` cookie, or in the `visitor_data` value which is sent with Innertube API requests. 

When logged in, the PO Token is bound to the account "Data Sync ID" rather than the Visitor ID.

### Manually acquiring a PO Token from a browser

This process goes through manually obtaining a PO Token generated on YouTube in a web browser, and then manually passing that to yt-dlp via the `po_token` extractor argument.

#### If using yt-dlp without an account

Steps:

1. Open a browser and go to any video on YouTube Music or YouTube Embedded (e.g. https://www.youtube.com/embed/aqz-KE-bpKQ).
2. Open the developer console (F12), then go to the "Network" tab and filter by `v1/player`
3. Click the video to play and a player request will appear in the network tab.
4. In the request payload JSON, find the PO Token at `serviceIntegrityDimensions.poToken` and save that value.
5. Export cookies from the browser.
6. Pass the PO Token to yt-dlp using `--extractor-args "youtube:player-client=web,default;po_token=web:PO_TOKEN_VALUE_HERE"` with cookies (`--cookies COOKIES_FILE`)

Addendum:

- You can also get the PO Token from any of the `videoplayback` urls (it is the `pot` query parameter).
- You can also use `--cookies-from-browser` if that is pointed to the browser session with the same logged-out session you extracted the PO Token from.

##### Passing visitor_data without cookies

In some cases, you may not want to use cookies and instead just use the `visitor_data` extracted for Innertube API requests. 

> Note: This method is  **not recommend** for most cases. It requires skipping webpage requests so the `VISITOR_INFO1_LIVE` cookies does not interfere, which will mean more requests, and less stable extraction.

You can do this with:

`--extractor-args "youtube:player-client=web,default;player-skip=webpage,configs;po_token=web:PO_TOKEN_VALUE_HERE;visitor_data=VISITOR_DATA_VALUE_HERE"`


#### If using yt-dlp with an account

This works with either cookies or [OAuth](https://github.com/coletdjnz/yt-dlp-youtube-oauth2).

> As of writing, it appears that when logged in, YouTube Embedded *does not* bind the PO Token to the Data Sync ID. This will mean PO Tokens from it will not work with the `web` client when using auth, which requires it is bound to the Data Sync ID. We can use YouTube Music instead to fetch the PO Token which does this.

Steps:

1. Open a browser and go to YouTube Music
2. Log in to the user you are using with yt-dlp
3. Open any video on YouTube Music
4. Follow steps 2-4 [above](#if-using-yt-dlp-without-an-account)
5. Pass the PO Token to yt-dlp using `--extractor-args "youtube:player-client=web,default;po_token=web:PO_TOKEN_VALUE_HERE"` with your method of auth (cookies or OAuth).

If you are using cookies, see [Exporting YouTube Cookies](#exporting-youtube-cookies) on how to export cookies without them being invalidated.

## Exporting YouTube cookies

YouTube rotates cookies frequently on open YouTube browser tabs as a security measure.
To export cookies that will remain working with yt-dlp, you will need to export cookies in such a way that they are never rotated. 

One way to do this is through a private browsing/incognito window:
1. Open a new private browsing/incognito window and log into YouTube
2. Open a new tab and **close the YouTube tab**
3. Export cookies from the browser then **close the private browsing/incognito window** so the session is never opened in the browser again.
